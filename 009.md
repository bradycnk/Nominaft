
-- 1. Asegurar que el bucket exista y sea público para visualización de logos
INSERT INTO storage.buckets (id, name, public)
VALUES ('expedientes', 'expedientes', true)
ON CONFLICT (id) DO UPDATE SET public = true;

-- 2. Política para permitir a usuarios autenticados subir logos a la carpeta logos/
CREATE POLICY "Permitir carga de logos en folder logos"
ON storage.objects FOR INSERT
TO authenticated
WITH CHECK (bucket_id = 'expedientes' AND (storage.foldername(name))[1] = 'logos');

-- 3. Política para permitir actualización de objetos existentes por admins
CREATE POLICY "Permitir actualización de logos"
ON storage.objects FOR UPDATE
TO authenticated
USING (bucket_id = 'expedientes');

-- 4. Política para lectura pública de los logos (Necesario para los PDF y UI)
CREATE POLICY "Lectura pública de logos"
ON storage.objects FOR SELECT
USING (bucket_id = 'expedientes');
