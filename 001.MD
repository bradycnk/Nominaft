
-- 1. Actualizar tabla de empleados con nuevos campos
ALTER TABLE empleados 
ADD COLUMN IF NOT EXISTS rif TEXT,
ADD COLUMN IF NOT EXISTS cv_url TEXT;

-- 2. Crear bucket de storage para expedientes si no existe
-- Nota: En Supabase UI esto es más sencillo, pero aquí definimos la lógica de seguridad
-- INSERT INTO storage.buckets (id, name, public) VALUES ('expedientes', 'expedientes', false);

-- 3. Políticas de Seguridad para el Storage de Expedientes
-- Permitir a administradores autenticados subir archivos
CREATE POLICY "Admins pueden subir expedientes" 
ON storage.objects FOR INSERT 
TO authenticated 
WITH CHECK (bucket_id = 'expedientes');

-- Permitir a administradores leer archivos
CREATE POLICY "Admins pueden ver expedientes" 
ON storage.objects FOR SELECT 
TO authenticated 
USING (bucket_id = 'expedientes');

-- Permitir a administradores actualizar/eliminar
CREATE POLICY "Admins pueden gestionar expedientes" 
ON storage.objects FOR ALL 
TO authenticated 
USING (bucket_id = 'expedientes');
12